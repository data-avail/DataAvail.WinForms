<?xml version="1.0" encoding="utf-8" ?>


<!--<DataSet adapterType="SQLite"
         connectionString="DataSource=$path(..\..\Data\NTRAST.db)" useStdCommands="true" typeConverter="int=long">-->
        <!--schemeName="dbo" connectionString="Data Source=BAIO-PC\BAIO;Initial Catalog=company;Integrated Security=True;Persist Security Info=True"-->
  

<DataSet adapterType="SqlServer" schemeName="dbo" connectionString="Data Source=.\SQLEXPRESS;Initial Catalog=company;Integrated Security=True;Persist Security Info=True"
         useStdCommands="true"> 

  <!--defaultTablePrefix="dbo_">-->
  <Table name="DEAL" autoFill="false" persistFill="false" source ="V_DEAL" sourceUpdate="DEAL">
    <Fields>
      <Field name = "ID" type="int" pk="true"/>
      <Field name = "CLIENT" type="int"/>
      <Field name = "CLIENT_NAME" type="string, 250" isMapped="false"/>
      <Field name = "MANAGER" type="int" />
      <Field name = "MANAGER_NAME" type="string, 250" isMapped="false"/>
      <Field name = "AGENT" type="int" />
      <Field name = "AGENT_NAME" type="string, 250" isMapped="false"/>
      <Field name = "TYPE" type="int" defaultValue="0" />
      <Field name = "STATE" type="int" defaultValue="0"/>
      <Field name = "DATE" type="date" isMapped="false" />
      <Field name = "DESCRIPTION" type="string, 50" />
      <Field name = "PRICEFROMAGENT" type="double" />
      <Field name = "PRICEFORCLIENT" type="double" />
      <Field name = "PROFIT" type="double" />
      <Field name = "AGENTCURRENCY" type="int" defaultValue="0" />
      <Field name = "CLIENTCURRENCY" type="int" isMapped="false" defaultValue="0"/>
      <Field name = "RATE" type="double" />
      <Field name = "CLIENT_BIRTH_DATE" type="date" calculator="CLIENT;BIRTH_DATE" />
      <Field name = "CLIENT_MOBILE" type="string,50" calculator="CLIENT;CONTACT-PERSON-TAG[TYPE=0]" />
      <Field name = "CLIENT_EMAIL" type="string,50" calculator="CLIENT;CONTACT-PERSON-TAG[TYPE=3]" />
      <Field name = "AGENT_MOBILE" type="string,50" calculator="AGENT;CONTACT-PERSON-TAG[TYPE=0]" />
      <Field name = "AGENT_EMAIL" type="string,50" calculator="AGENT;CONTACT-PERSON-TAG[TYPE=3]" />
      <Field name = "VISA_DURATION" type="int" />
      <Field name = "VISA_COUNTRY" type="int" />
      <Field name = "CLIENT_REGION" type="string,50" calculator="CLIENT;REGION,REGION;NAME"/>
    </Fields>
  </Table>
  <Table name="COUNTRY" autoFill="true">
    <Fields>
      <Field name = "ID" type="int" pk="true"/>
      <Field name = "NAME" type="string,50" />
    </Fields>
  </Table>
  <Table name="REGION" autoFill="true">
    <Fields>
      <Field name = "ID" type="int" pk="true" isPkAutoGenerated="false"/>
      <Field name = "NAME" caption="Название" type="string,50" />
    </Fields>
  </Table>
  <Table name="DEAL_STATE" autoFill="true">
    <Fields>
      <Field name = "ID" type="int" pk="true" isPkAutoGenerated="false"/>
      <Field name = "NAME" caption="Название" type="string,50" />
    </Fields>
  </Table>
  <Table name="DEAL_TYPE" autoFill="true">
    <Fields>
      <Field name = "ID" type="int" pk="true"/>
      <Field name = "NAME" type="string,50" />
      <Field name = "DAYS" type="int" />
      <Field name = "TYPE" type="int" defaultValue="0" />
    </Fields>
  </Table>
  <Table name="CURRENCY" autoFill="true" >
    <Fields>
      <Field name = "ID" type="int" pk="true" readOnly="false"/>
      <Field name = "NAME" type="string,50" />
      <Field name = "MNEM" type="string,10" />
    </Fields>
  </Table>
  <Table name="PERSON" source ="V_PERSON" sourceUpdate="PERSON" autoFill="true">
    <Fields>
      <Field name = "ID" type="int" pk="true"/>
      <Field name = "FIRST_NAME" type="string,50"/>
      <Field name = "LAST_NAME" type="string,50"/>
      <Field name = "MIDDLE_NAME" type="string,50"/>
      <Field name = "SEX" type="int" defaultValue="0" />
      <Field name = "PREFIX" type="int"/>
      <Field name = "BIRTH_DATE" type="date"/>
      <Field name = "STATE" type="int" isMapped="false"/>
      <Field name = "TYPE" type="int" defaultValue="0"/>
      <Field name = "NAME" type="string,100" isMapped="false"/>
      <Field name = "REGION" type="int" defaultValue="0"/>
    </Fields>
  </Table> 
  <Table name="ADDRESS">
    <Fields>
      <Field name="ID" type="int" pk="true"/>
      <Field name="PERSON" type="int" />
      <Field name="COUNTRY" type="string,50" nullable="true" />
      <Field name="CITY" type="string,50" nullable="true" />
      <Field name="CITY_TYPE" type="string,25" nullable="true" />
      <Field name="STREET" type="string,50" nullable="true" />
      <Field name="STREET_TYPE" type="string,25" nullable="true" />
      <Field name="HOME" type="string,25" nullable="true" />
      <Field name="ROOM" type="string,25" nullable="true" />
      <Field name="REGION" type="string,100" nullable="true" />
      <Field name="SUBREGION" type="string,100" nullable="true" />
      <Field name="DEPENDED_LOCALITY" type="string,50" nullable="true" />
      <Field name="POSTAL_CODE" type="string,10" nullable="true" />
	  <Field name="ADDR" type="string,500" nullable="true"/>
    </Fields>
  </Table>
  <Table name="CONTACT">
    <Fields>
      <Field name = "ID" type="int" pk="true" />
      <Field name = "PERSON" type="int"/>
      <Field name = "TAG" type="string,50" />
      <Field name = "TYPE" type="int" defaultValue="0"/>
      <Field name = "AUX" type="string,50" />
    </Fields>
  </Table>
  -->
  <Table name="CVL" autoFill="true">
    <Fields>
      <Field name = "ID" type="int" pk="true"/>
      <Field name = "TABLE_NAME" type="string,50"/>
      <Field name = "COLUMN_NAME" type="string,50"/>
      <Field name = "CONST_VAL" type="int"/>
      <Field name = "CONST_NAME" type="string,50" />
    </Fields>
  </Table>
  <Relations>
    <!--CONTACT-->
    <Relation name="CONTACT_TYPE" parentTable = "CVL" parentField = "CONST_VAL" childTable = "CONTACT" childField = "TYPE" filter = "TABLE_NAME = 'CONTACT' AND COLUMN_NAME = 'TYPE'"/>
    <!--ADDRESS-->
    <Relation name="ADDRESS_TOWN" parentTable = "TOWN" parentField = "ID" childTable = "ADDRESS" childField = "TOWN"/>
    <!--PERSON-->
    <Relation name="ADDRESS_PERSON" parentTable = "PERSON" parentField = "ID" childTable = "ADDRESS" childField = "PERSON" ShowChildren="true"/>
    <Relation name="CONTACT_PERSON" parentTable = "PERSON" parentField = "ID" childTable = "CONTACT" childField = "PERSON" ShowChildren="true"/>
    <Relation name="PERSON_SEX" parentTable = "CVL" parentField = "CONST_VAL" childTable = "PERSON" childField = "SEX" filter = "TABLE_NAME = 'PERSON' AND COLUMN_NAME = 'SEX'"/>
    <Relation name="PERSON_PREFIX" parentTable = "CVL" parentField = "CONST_VAL" childTable = "PERSON" childField = "PREFIX" filter = "TABLE_NAME = 'PERSON' AND COLUMN_NAME = 'PREFIX'"/>
    <Relation name="PERSON_TYPE" parentTable = "CVL" parentField = "CONST_VAL" childTable = "PERSON" childField = "TYPE" filter = "TABLE_NAME = 'PERSON' AND COLUMN_NAME = 'TYPE'"/>
    <Relation name="PERSON_STATE" parentTable = "CVL" parentField = "CONST_VAL" childTable = "PERSON" childField = "STATE" filter = "TABLE_NAME = 'PERSON' AND COLUMN_NAME = 'STATE'"/>
    <Relation name="PERSON_REGION" parentTable = "REGION" parentField = "ID" childTable = "PERSON" childField = "REGION"/>
    <!---DEAL-->
    <Relation name="DEAL_CLIENT" parentTable = "PERSON" parentField = "ID" childTable = "DEAL" childField = "CLIENT" filter="TYPE=0" />
    <Relation name="DEAL_AGENT" parentTable = "PERSON" parentField = "ID" childTable = "DEAL" childField = "AGENT"  filter="TYPE=1" />
    <Relation name="DEAL_MANAGER" parentTable = "PERSON" parentField = "ID" childTable = "DEAL" childField = "MANAGER"  filter="TYPE=2" />
    <Relation name="DEAL_STATE" parentTable = "DEAL_STATE" parentField = "ID" childTable = "DEAL" childField = "STATE" />
    <Relation name="DEAL_TYPE" parentTable = "DEAL_TYPE" parentField = "ID" childTable = "DEAL" childField = "TYPE"/>
    <Relation name="DEAL_AGENTCURRENCY" parentTable = "CURRENCY" parentField = "ID" childTable = "DEAL" childField = "AGENTCURRENCY"/>
    <Relation name="DEAL_CLIENTCURRENCY" parentTable = "CURRENCY" parentField = "ID" childTable = "DEAL" childField = "CLIENTCURRENCY"/>
    <Relation name="DEAL_VISA_DURATION" parentTable = "CVL" parentField = "CONST_VAL" childTable = "DEAL" childField = "VISA_DURATION" filter = "TABLE_NAME = 'DEAL' AND COLUMN_NAME = 'VISA_DURATION'"/>
    <Relation name="DEAL_VISA_COUNTRY" parentTable = "COUNTRY" parentField = "ID" childTable = "DEAL" childField = "VISA_COUNTRY"/>
    <!--DEAL_TYPE-->
    <Relation name="DEAL_TYPE_TYPE" parentTable = "CVL" parentField = "CONST_VAL" childTable = "DEAL_TYPE" childField = "TYPE" filter = "TABLE_NAME = 'DEAL_TYPE' AND COLUMN_NAME = 'TYPE'"/>
  </Relations>
</DataSet>